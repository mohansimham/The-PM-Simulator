<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1: PM Fundamentals - Airbnb Platform Evolution</title>
    <meta name="description" content="Test your product management fundamentals with this Airbnb case study simulation.">
    
    <!-- Open Graph for LinkedIn sharing -->
    <meta property="og:title" content="Week 1: PM Fundamentals - Airbnb Simulation">
    <meta property="og:description" content="Can you navigate Airbnb's early growth decisions? Test your PM skills.">
    <meta property="og:type" content="website">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ========================================
           READABILITY OPTIMIZATION
           Based on research from:
           - Nielsen Norman Group
           - U.S. Web Design System (USWDS)
           - WCAG Guidelines
           - Cognitive Load Theory
           ======================================== */
        
        /* Optimal typography for scenarios */
        .scenario-content {
            font-size: 16px;
            line-height: 1.6;
            color: #1f2937;
            max-width: 65ch; /* Research: 50-75 characters optimal */
        }
        
        .scenario-content p {
            margin-bottom: 1.25em; /* Generous spacing between paragraphs */
        }
        
        /* Visual hierarchy for section headers */
        .scenario-content strong {
            display: block;
            color: #1e40af;
            font-weight: 600;
            font-size: 15px;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            letter-spacing: 0.01em;
        }
        
        /* First paragraph special handling */
        .scenario-content p:first-of-type {
            font-weight: 500;
            color: #111827;
        }
        
        /* Optimal typography for feedback */
        .feedback-content {
            font-size: 15px;
            line-height: 1.65; /* Slightly higher for extended reading */
            color: #374151;
            max-width: 62ch;
        }
        
        .feedback-content p {
            margin-bottom: 1.15em;
        }
        
        /* Emphasis within feedback */
        .feedback-content p:first-child {
            font-weight: 500;
            color: #1f2937;
        }
        
        /* Question text optimization */
        .question-text {
            font-size: 17px;
            line-height: 1.5;
            font-weight: 600;
            color: #111827;
            max-width: 60ch;
        }
        
        /* Option text optimization */
        .option-text {
            font-size: 15px;
            line-height: 1.5;
            color: #1f2937;
        }
        
        /* Reduce cognitive load with subtle visual cues */
        .section-label {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            margin-bottom: 0.75em;
        }
        
        /* Professional formal color overrides */
        .bg-indigo-600 { background-color: #1e40af !important; }
        .bg-indigo-100 { background-color: #dbeafe !important; }
        .text-indigo-600 { color: #1e40af !important; }
        .border-indigo-500 { border-color: #2563eb !important; }
        .from-indigo-600 { --tw-gradient-from: #1e40af !important; }
        .to-blue-600 { --tw-gradient-to: #3b82f6 !important; }
        
        /* Smooth animations */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState, useEffect } = React;
        const { createElement: h } = React;

        // Google Apps Script Web App URL for email collection
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6E8UJUn5xhilm2pLWjdvaip_6MnSCf-XRVPv5u4hOttjr0SNCu9I10q2ESLKGQ04_mQ/exec';

        // Icon components
        const Share2Icon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8' }),
            h('polyline', { points: '16 6 12 2 8 6' }),
            h('line', { x1: 12, y1: 2, x2: 12, y2: 15 })
        );

        const MailIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z' }),
            h('polyline', { points: '22,6 12,13 2,6' })
        );

        const TrophyIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6' }),
            h('path', { d: 'M18 9h1.5a2.5 2.5 0 0 0 0-5H18' }),
            h('path', { d: 'M4 22h16' }),
            h('path', { d: 'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22' }),
            h('path', { d: 'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22' }),
            h('path', { d: 'M18 2H6v7a6 6 0 0 0 12 0V2Z' })
        );

        const TrendingUpIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('polyline', { points: '23 6 13.5 15.5 8.5 10.5 1 18' }),
            h('polyline', { points: '17 6 23 6 23 12' })
        );

        const UsersIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }),
            h('circle', { cx: 9, cy: 7, r: 4 }),
            h('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }),
            h('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' })
        );

        function PMSimulation() {
            const [email, setEmail] = useState('');
            const [hasStarted, setHasStarted] = useState(false);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [selectedAnswerIndex, setSelectedAnswerIndex] = useState(null);
            const [showResults, setShowResults] = useState(false);
            const [hasAttempted, setHasAttempted] = useState(false);

            // SNIPPET 1: Session Persistence - Restore email on page load
            useEffect(() => {
                const storedEmail = localStorage.getItem('pmSimEmail');
                const storedStartTime = localStorage.getItem('pmSimStartTime');
                
                if (storedEmail) {
                    setEmail(storedEmail);
                    const hoursSinceStart = (Date.now() - new Date(storedStartTime)) / (1000 * 60 * 60);
                    if (hoursSinceStart < 24) {
                        setHasStarted(true);
                    }
                }
            }, []);

            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const resetMode = urlParams.get('reset') === 'true';
                
                if (resetMode) {
                    localStorage.removeItem('pm_simulation_week1_attempted');
                    setHasAttempted(false);
                } else {
                    const attempted = localStorage.getItem('pm_simulation_week1_attempted');
                    if (attempted) {
                        setHasAttempted(true);
                    }
                }
            }, []);

            const simulation = {
                title: "Airbnb's Platform Evolution: PM Fundamentals",
                company: "Airbnb",
                week: "Week 1",
                year: "2026",
                description: "You're a PM at early-stage Airbnb. The company started by renting air mattresses during a design conference. Now you need to scale to a global platform. Make critical decisions that will define what product management means at Airbnb.",
                questions: [
                    {
                        id: 1,
                        scenario: "**July 2009 – The NYC Photo Crisis**\n\n**The Situation:**\nYou're a PM at Airbnb with 4 months of runway left. Revenue is $200/week. The team is eating leftover cereal from a desperate fundraising stunt.\n\n**The Discovery:**\nBrian Chesky just visited 24 NYC listings. Every single one has terrible photos—blurry shots, bad lighting, cropped furniture.\n\n**The Reality:**\nHosts aren't photographers. They're teachers and nurses trying to make rent.\n\n**Paul Graham's Proposal:**\n"Fly to NYC, rent a $5,000 camera, photograph every listing yourselves. It won't scale, but it might save the company."\n\n**The Conflict:**\nNathan (CTO): "This is a waste of time. We should build scalable features—algorithms, better search, payment improvements."\n\nThe burn rate calculator blinks: 4 months left.",
                        question: "How do you make the case for or against this \"unscalable\" photography intervention?",
                        options: [
                            {
                                text: "Decline the trip and prioritize building scalable technology features instead",
                                points: 2,
                                feedback: "Here's what separates theory from practice: you're optimizing for hypothetical scale before you've proven Product-Market Fit.\n\nIn early-stage products, \"scalable solutions\" mean nothing if you have zero customers. Premature scaling kills more startups than failed experiments.\n\nAirbnb proved this when their revenue literally doubled from $200 to $400/week after the photo intervention.\n\nSometimes the right answer is doing things that don't scale—because that's how you learn what actually matters.\n\nReid Hoffman said it best: \"If you're not embarrassed by your first product, you launched too late.\" This applies to strategies too."
                            },
                            {
                                text: "Execute the NYC photo experiment immediately—test the hypothesis that photos drive bookings",
                                points: 10,
                                feedback: "Perfect. This is how real PMs think when survival is on the line.\n\nYou identified the actual constraint (trust/visual clarity), proposed a falsifiable hypothesis (better photos = more bookings), and designed the cheapest possible experiment to test it.\n\nCost: $5K camera + 3 plane tickets + 1 week. When revenue doubled in one week, you had your answer.\n\nThen—and only then—you figured out how to scale it (photography program launched summer 2010).\n\nThis is Lean Startup done right: learn fast, iterate faster. The lesson isn't \"ignore scale forever.\" It's \"learn what works before you scale what doesn't.\""
                            },
                            {
                                text: "Hire a professional photography agency to shoot all listings nationwide immediately",
                                points: 4,
                                feedback: "You're solving the right problem but skipping the learning phase.\n\nWith 4 months of runway, you can't afford to spend $50K+ on an unvalidated hypothesis.\n\nWhat if photos don't matter? What if hosts reject photographer intrusions? What if guests don't care?\n\nTest cheaply first, then scale what works.\n\nThis is why Airbnb founders went door-to-door themselves—they needed to see the problem up close, understand host psychology, and learn whether this was THE bottleneck or just ONE bottleneck.\n\nAlways de-risk before you deploy capital."
                            },
                            {
                                text: "Add a \"photo quality score\" feature to incentivize hosts to improve their own photos",
                                points: 6,
                                feedback: "This is a clever product solution, but it misunderstands the core problem.\n\nHosts aren't lazy—they lack the skill, equipment, and aesthetic sense to take professional photos.\n\nYou can't gamify your way out of a capabilities gap.\n\nAirbnb learned this the hard way: most hosts are teachers, nurses, retirees—not photographers. They don't even know what \"good\" looks like.\n\nThis would've resulted in slightly better amateur photos, not the 2-3x booking increase that professional photography delivered.\n\nProduct features can't fix every problem. Sometimes you need human intervention."
                            }
                        ]
                    },
                    {
                        id: 2,
                        scenario: "**September 2010 – Scaling the Photography Program**\n\n**The Success:**\nThe NYC experiment worked spectacularly. Listings with professional photos are booked 2.5X more frequently. Hosts earn an average of $1,025/month more.\n\n**The Opportunity:**\nYou've just closed a $7.2M Series A from Greylock and Sequoia. The company is finally profitable enough to think beyond survival mode.\n\n**The Proposal:**\nScale the photography program globally. Offer free professional photography to every host.\n\n**The Cost:**\n$100-150 per photoshoot. If half your 10,000 hosts opt in, that's $1M-1.5M annually. That's 15-20% of your entire Series A.\n\n**The Pushback:**\nBoard members: \"We should invest that money in paid acquisition, mobile apps, or international expansion instead. Photography is a nice-to-have, not a must-have.\"\n\n**The Data:**\nHosts who get professional photos are 50% more likely to remain active after 6 months. Professional photos reduce customer support tickets by 30%. Photos improve search ranking and guest trust scores significantly.\n\n**The Competition:**\nVRBO and HomeAway are watching. They could copy this strategy.",
                        question: "Should Airbnb invest $1M+ annually in a free global photography program, or is this capital better deployed elsewhere?",
                        options: [
                            {
                                text: "Invest fully in the photography program—it's a competitive moat disguised as a cost center",
                                points: 10,
                                feedback: "Brilliant. You're seeing what others miss: this isn't a marketing expense, it's a growth flywheel.\n\nHere's the unit economics: spend $100 on photos → host earns $1,025 more per month → host stays on platform longer → Airbnb keeps 9-15% of every booking → you're cash-flow positive in month 1 and profitable for years.\n\nBut the real genius is the moat. VRBO and HomeAway can't copy this—they don't have the culture, the host relationships, or the willingness to subsidize quality.\n\nBy 2012, Airbnb had 2,000 freelance photographers doing 13,000 shoots across six continents. Competitors never caught up.\n\nThis is how you win: identify what creates asymmetric value for your platform, then scale it before anyone realizes it's a moat."
                            },
                            {
                                text: "Make photography a paid premium service for serious hosts only",
                                points: 5,
                                feedback: "You're trying to have it both ways—capture the value without the cost.\n\nProblem is, you've just filtered out exactly the hosts who need help most: first-timers, budget-conscious folks, people in lower-income markets.\n\nThese are the hosts who'll bring authenticity and diversity to your platform.\n\nBy charging for photography, you're creating a two-tier system where rich hosts get better listings and poor hosts get ignored.\n\nThis isn't just bad optics—it's bad business. Your platform's strength is inventory diversity.\n\nKeep it free to keep the marketplace healthy."
                            },
                            {
                                text: "Allocate the budget to paid acquisition and mobile app development instead",
                                points: 3,
                                feedback: "Classic mistake: confusing customer acquisition with customer quality.\n\nSure, you can spend $1M on Facebook ads and get 50,000 new users—but if your listings still have terrible photos, those users won't convert into bookings.\n\nPaid acquisition without conversion rate optimization is like pouring water into a leaky bucket.\n\nAirbnb's genius was realizing that improving supply quality (better photos) automatically improved demand (more bookings), which attracted better supply (higher-earning hosts), which attracted more demand.\n\nThat's a flywheel. Paid ads are linear.\n\nBuild flywheels, not funnels."
                            },
                            {
                                text: "Partner with camera companies to provide discounted equipment and training to hosts",
                                points: 4,
                                feedback: "This sounds strategic but misses the point entirely.\n\nYou're solving the wrong problem again. Hosts don't need equipment or training—they need results.\n\nThey're busy people who want to rent their space, not become photographers.\n\nEven if you gave them a free DSLR and a 2-hour tutorial, most wouldn't use it correctly.\n\nRemember: Airbnb isn't selling photography—they're selling trust.\n\nThe fastest way to build trust is professional-grade visuals, which requires professional photographers.\n\nSometimes the best product strategy is a service layer, not a software feature."
                            }
                        ]
                    },
                    {
                        id: 3,
                        scenario: "**2011 – Designing the Two-Way Review System**\n\n**The Challenge:**\nAirbnb is built on trust between strangers. You need a review system that's honest but doesn't discourage participation.\n\n**The Problem:**\nIf guests review first, hosts might retaliate with negative reviews. If hosts review first, guests might sugarcoat feedback to avoid conflict.\n\n**The Options:**\nYou're designing the review mechanism. This decision will shape trust dynamics for years.\n\n**The Considerations:**\nPsychology matters. People behave differently when they know they're being judged. Your system needs to encourage honest feedback without creating a toxic environment.\n\n**The Stakes:**\nGet this wrong, and your marketplace becomes either too lenient (fake reviews) or too harsh (people afraid to participate).\n\n**The Data:**\nPlatforms with one-way reviews see 30% fake positive reviews. Platforms with transparent reviews see 40% lower participation.\n\n**The Goal:**\nMaximize honesty while minimizing retaliation.",
                        question: "How should Airbnb's review system work?",
                        options: [
                            {
                                text: "Guests review first, then hosts respond—guests have more power as customers",
                                points: 20,
                                feedback: "This seems customer-centric, but it creates an imbalanced marketplace.\n\nIf guests always review first, hosts are incentivized to please guests at all costs—even when guests violate house rules.\n\nThis leads to host burnout and supply-side churn.\n\nRemember: Airbnb is a two-sided marketplace. Both sides need equal power, or the marketplace breaks.\n\nThe best platforms treat both sides as customers.\n\nAlso, guests who know hosts can't retaliate might leave unfairly harsh reviews, knowing there's no consequence."
                            },
                            {
                                text: "Hosts review first, then guests respond—hosts take the risk so they should review first",
                                points: 15,
                                feedback: "This protects hosts but creates the opposite problem.\n\nGuests who know they'll be reviewed first might sugarcoat their feedback to avoid conflict with the host.\n\nThis leads to grade inflation—everyone gets 5 stars, and the review system becomes meaningless.\n\nYou need a mechanism that prevents retaliation while encouraging honest feedback from both sides.\n\nSequencing alone doesn't solve the problem."
                            },
                            {
                                text: "Both review simultaneously—reviews are hidden until both submit or 14 days pass",
                                points: 45,
                                feedback: "Perfect. This is the double-blind mechanism Airbnb actually implemented.\n\nHere's why it's genius: neither party knows what the other wrote until both reviews are submitted (or 14 days pass).\n\nThis removes retaliation fear—you can be honest because you don't know what they'll say about you.\n\nIt also creates urgency—if you don't review within 14 days, the other person's review goes live anyway.\n\nThis is game theory in action. You've designed incentives so that honesty is the optimal strategy for both parties.\n\nAirbnb still uses this system today. It's one of the best examples of mechanism design in tech."
                            },
                            {
                                text: "Make reviews optional—only serious issues get flagged",
                                points: 10,
                                feedback: "This seems low-friction, but it kills the trust infrastructure.\n\nOptional reviews mean only people with extreme experiences (very good or very bad) will leave feedback.\n\nYou'll get a bimodal distribution—5 stars or 1 star, nothing in between.\n\nThis doesn't help future users make informed decisions.\n\nTrust-based marketplaces need consistent, normalized feedback.\n\nMake it easy, but make it expected."
                            }
                        ]
                    },
                    {
                        id: 4,
                        scenario: "**2013 – San Francisco's Regulatory Threat**\n\n**The Crisis:**\nSan Francisco is proposing legislation to ban short-term rentals under 30 days. If passed, Airbnb's second-largest market disappears overnight.\n\n**The Context:**\nSF housing activists blame Airbnb for rising rents. Hotels lobby for regulation. The Board of Supervisors is listening.\n\n**The Options:**\nYour legal and policy teams present three strategies.\n\n**The Pressure:**\nThis isn't just about SF. How you respond here sets precedent for NYC, Paris, London, Barcelona—every major city will watch.\n\n**The Data:**\nAirbnb hosts in SF earn an average of $14,000/year. 52% use the income to stay in their homes. 78% of listings are primary residences.\n\n**The Politics:**\nSome politicians are open to compromise. Others want to kill the company to make a statement.\n\n**The Long Game:**\nYou need to win this fight without alienating every city government globally.",
                        question: "How should Airbnb respond to San Francisco's regulatory threat?",
                        options: [
                            {
                                text: "Fight aggressively—lobby hard, threaten to pull out of SF, run ads attacking the legislation",
                                points: 20,
                                feedback: "This approach is confrontational and short-sighted.\n\nWhile Uber successfully used this playbook in some markets, it also made Uber a villain in the eyes of regulators globally.\n\nAggressive lobbying works when you have populist support, but Airbnb's impact on housing is legitimately concerning to many SF residents.\n\nFighting every regulation makes you look like you don't care about communities.\n\nYou'll win battles but lose the war. Better to find a middle ground that lets you operate while addressing legitimate concerns."
                            },
                            {
                                text: "Comply fully—accept the 30-day minimum, pivot to longer-term stays only in SF",
                                points: 25,
                                feedback: "This is too passive. You're letting regulators define your business model.\n\nWhile compliance is important, accepting a 30-day minimum kills your core value proposition—short-term travel stays.\n\nYou'd be conceding defeat in your second-largest market without fighting for the hosts who depend on you.\n\nThere's a middle ground between full compliance and full confrontation.\n\nPropose a compromise that addresses legitimate housing concerns while preserving your business."
                            },
                            {
                                text: "Propose a compromise—voluntary 90-day annual cap, host registration system, tax collection",
                                points: 45,
                                feedback: "Brilliant. This is what Airbnb actually did, and it's a masterclass in regulatory strategy.\n\nBy proactively proposing a 90-day cap on non-primary residences, you address the core concern (commercial operators buying properties purely for Airbnb) while protecting your core users (people renting their primary homes).\n\nThe registration system gives the city visibility and control. Tax collection makes you a revenue partner, not an adversary.\n\nThis is how you turn potential enemies into allies. You're not fighting regulation—you're shaping it.\n\nSF eventually passed a version of this. Other cities followed. You set the precedent."
                            },
                            {
                                text: "Ignore the threat—keep operating, dare the city to shut you down",
                                points: 15,
                                feedback: "This is the Uber playbook, and while it worked for them in some markets, it's a huge gamble.\n\nIgnoring regulators makes you look arrogant and reckless. It galvanizes opposition and gives politicians ammunition.\n\nIf SF shuts you down, that precedent cascades globally—every city will think they can ban you.\n\nYou need regulators to see you as a partner, not an enemy.\n\nOperate in legal gray areas when you must, but never openly defy regulation. That's how you lose."
                            }
                        ]
                    },
                    {
                        id: 5,
                        scenario: "**2011 – The EJ Ransacking Incident**\n\n**The Crisis:**\nA host's home was ransacked by a guest. International media picked up the story. \"Airbnb guest destroys home\" is trending.\n\n**The Backstory:**\nHost EJ wrote a blog post detailing the damage. Airbnb's initial response was slow and bureaucratic. She went public. This is now a PR disaster.\n\n**The Immediate Impact:**\nBookings down 20%. Press calling it a \"trust crisis.\" Investors questioning whether the model works.\n\n**The Question:**\nThis is an existential moment. How you respond defines whether Airbnb survives.\n\n**The Options:**\nYour crisis team presents response strategies.\n\n**The Reality:**\nYou can't prevent every bad actor. But you can control how you respond when things go wrong.\n\n**The Stakes:**\nTrust is your only moat. Lose it, and the marketplace collapses.",
                        question: "How should Airbnb respond to the EJ ransacking crisis?",
                        options: [
                            {
                                text: "Apologize privately, settle with EJ, move on quietly—don't amplify the story",
                                points: 20,
                                feedback: "This is damage control, not trust building.\n\nQuiet settlements might protect your reputation in the short term, but they don't address the systemic issue.\n\nEvery potential host is now wondering: \"If this happens to me, will Airbnb help?\"\n\nYour silence is an answer. And it's the wrong one.\n\nCrises are opportunities to show your values. Hiding makes you look like you have something to hide."
                            },
                            {
                                text: "Launch a $1M Host Guarantee, offer 24/7 customer support, implement ID verification",
                                points: 45,
                                feedback: "Perfect. This is exactly what Airbnb did, and it saved the company.\n\nThe $1M Host Guarantee was symbolic—it told hosts \"we've got your back.\" The actual cost was minimal because incidents are rare, but the psychological impact was huge.\n\n24/7 support showed you were serious about safety. ID verification addressed the root cause (anonymous bad actors).\n\nBut here's the genius: you didn't just fix EJ's problem—you built a scalable trust infrastructure that made every future incident easier to handle.\n\nThis is how you turn a crisis into a competitive advantage."
                            },
                            {
                                text: "Suspend all new bookings until you implement better screening",
                                points: 25,
                                feedback: "This seems responsible, but it's an overreaction.\n\nSuspending bookings signals panic. It also punishes millions of good users for one bad actor.\n\nThe problem isn't that you need to screen everyone perfectly—that's impossible. The problem is you didn't have a safety net for when things go wrong.\n\nThe better response: keep operating, but add protections (guarantees, insurance, support).\n\nDon't let one incident define the platform. Show you can handle adversity while moving forward."
                            },
                            {
                                text: "Blame EJ for not vetting the guest properly—this is a host responsibility issue",
                                points: 5,
                                feedback: "This is PR suicide and morally wrong.\n\nBlaming the victim destroys trust faster than any incident ever could.\n\nYour hosts are your partners, not your customers. If you don't protect them, they'll leave.\n\nYes, hosts should vet guests. But Airbnb positioned itself as the platform making peer-to-peer trust possible. When that fails, it's your responsibility to make it right.\n\nOwn the problem. Then solve it systematically."
                            }
                        ]
                    },
                    {
                        id: 6,
                        scenario: "**2014 – The Mobile-First Inflection Point**\n\n**The Data:**\nMobile bookings are growing fast. You're at 25% of total bookings. Competitors are at 40%+. This is a trend, not a blip.\n\n**The Reality:**\nYour mobile app is functional but not great. It's a shrunk-down version of the website. Users complain it's clunky.\n\n**The Proposal:**\nEngineering wants to completely rebuild the mobile experience from scratch. This means pausing new features for 6 months.\n\n**The Debate:**\nCEO: \"Mobile is the future, but can we afford to stop shipping features for half a year?\"\n\nCTO: \"If we don't go mobile-first now, we'll be playing catchup forever.\"\n\nCFO: \"We just went public. Investors expect growth, not engineering rewrites.\"\n\n**The Stakes:**\nThis isn't just about mobile. It's about whether you lead or follow.",
                        question: "Should Airbnb commit to a mobile-first redesign, pausing other features for 6 months?",
                        options: [
                            {
                                text: "Yes—go mobile-first immediately, even if it means pausing desktop features",
                                points: 45,
                                feedback: "Correct. This is what Airbnb did, and by 2015, 50% of bookings were on mobile.\n\nHere's why this was the right call: mobile isn't a channel—it's a behavior shift. Users book differently on mobile (more spontaneous, more last-minute, more local).\n\nIf you just shrink your desktop experience, you miss the unique value mobile creates.\n\nYes, you'll sacrifice 6 months of new features. But you'll gain a platform advantage that lasts years.\n\nThe companies that won mobile (Instagram, Snap, Uber) went mobile-first early. The companies that hesitated (Facebook, Google) had to play catchup.\n\nWhen platforms shift, you need to move fast, even if it hurts short-term metrics."
                            },
                            {
                                text: "No—improve mobile incrementally, don't pause other work",
                                points: 25,
                                feedback: "This seems pragmatic, but it's strategically weak.\n\nIncremental improvements on a fundamentally flawed architecture rarely work. You end up with technical debt and a mediocre experience.\n\nBy 2016, mobile-first competitors (Booking.com, Hotels.com) had better apps than you. You lost market share.\n\nThe problem with incrementalism is it optimizes for short-term metrics (keep shipping features, keep investors happy) while missing the platform shift.\n\nSometimes you need to stop building the house and fix the foundation."
                            },
                            {
                                text: "Hire a separate mobile team so you can do both simultaneously",
                                points: 35,
                                feedback: "This sounds efficient, but it creates organizational problems.\n\nSeparate teams mean diverging priorities, duplicated code, and platform fragmentation.\n\nYou'll end up with a mobile app and a desktop app that feel like different products.\n\nAirbnb actually tried this initially, and it created chaos. They eventually unified teams around mobile-first.\n\nThe better approach: one team, mobile-first for everyone. Short-term pain, long-term alignment."
                            },
                            {
                                text: "Wait and see—if mobile bookings keep growing, you can pivot later",
                                points: 15,
                                feedback: "This is the \"wait and see\" trap that kills companies.\n\nBy the time you're certain about a trend, it's too late. Your competitors have already moved.\n\nMobile bookings are at 25% and growing. That's not a weak signal—that's a clear inflection point.\n\nStrong PMs make bets on probable trends before they become obvious. Waiting for certainty means waiting to lose.\n\nAct on strong signals, not perfect information."
                            }
                        ]
                    },
                    {
                        id: 7,
                        scenario: "**2012 – The Craigslist Growth Hack Dilemma**\n\n**The Opportunity:**\nYour growth team discovered that Craigslist doesn't secure its posting endpoints. You can build a bot that automatically cross-posts Airbnb listings to Craigslist.\n\n**The Upside:**\nCraigslist has 60M monthly users looking for housing. This could 10x your traffic overnight.\n\n**The Catch:**\nThis violates Craigslist's Terms of Service. It's technically possible but legally and ethically gray.\n\n**The Debate:**\nGrowth team: \"Everyone does this. It's a victimless hack. Craigslist doesn't enforce their ToS anyway.\"\n\nLegal: \"If Craigslist sues, we could lose. This could damage our reputation.\"\n\nCEO: \"We need growth. But not at any cost.\"\n\n**The Precedent:**\nOther startups used aggressive tactics and succeeded. But some got shut down or sued.\n\n**The Question:**\nWhere's the line between clever growth hacking and unethical behavior?",
                        question: "Should Airbnb automatically post to Craigslist despite violating their ToS?",
                        options: [
                            {
                                text: "Yes—do it until Craigslist stops you, growth is everything at this stage",
                                points: 15,
                                feedback: "This is short-term thinking that ignores long-term consequences.\n\nYes, this could drive growth. But you're building your company on a foundation of violating other platforms' rules.\n\nWhat happens when Craigslist shuts you down? What happens when this becomes public?\n\n\"Airbnb built by spamming Craigslist\" is not the narrative you want.\n\nAlso: if you'll violate Craigslist's ToS for growth, what other rules will you break? This sets a cultural precedent.\n\nGrowth at any cost is how you end up like Uber—winning but hated."
                            },
                            {
                                text: "No—build a Craigslist integration that respects their ToS and adds value",
                                points: 45,
                                feedback: "Perfect. This is the ethical and strategic approach.\n\nInstead of spamming Craigslist, build a tool that helps hosts post to both platforms manually. You're adding value (convenience) without breaking rules.\n\nAirbnb actually did this—they created a \"Post to Craigslist\" button that hosts could use. It wasn't automated spam; it was a helpful feature.\n\nThis approach is slower than automated posting, but it's sustainable and doesn't risk a lawsuit or reputation damage.\n\nThe best growth strategies don't rely on exploiting loopholes. They create genuine value that's defensible."
                            },
                            {
                                text: "Do it secretly—use VPNs and fake accounts so it's not traceable to Airbnb",
                                points: 5,
                                feedback: "This is worse than the obvious spam approach.\n\nNow you're not just violating ToS—you're actively trying to hide it. If this gets discovered, the narrative becomes: \"Airbnb secretly spammed Craigslist using fake accounts.\"\n\nThat's fraud territory. It also shows a pattern of deception that could haunt you in future regulatory battles.\n\nIf you wouldn't do something publicly, don't do it secretly. The coverup is always worse than the crime."
                            },
                            {
                                text: "Partner with Craigslist officially—offer them a revenue share for integration",
                                points: 35,
                                feedback: "This is a creative approach, but Craigslist historically doesn't partner.\n\nThey've turned down every acquisition offer and partnership proposal. Their founder, Craig Newmark, is famously anti-commercial.\n\nSo while this is the right instinct (create a win-win instead of exploiting), it's not realistic with Craigslist specifically.\n\nHowever, this thinking is valuable. Always ask: \"Can we align incentives instead of exploiting loopholes?\"\n\nThat mindset leads to sustainable partnerships, not legal battles."
                            }
                        ]
                    },
                    {
                        id: 8,
                        scenario: "**2016 – Addressing Discrimination**\n\n**The Problem:**\nA Harvard study reveals that Black guests are 16% less likely to be accepted by hosts than identical white guests. This is racial discrimination.\n\n**The Backlash:**\n#AirbnbWhileBlack is trending. Civil rights groups threaten lawsuits. This is a systemic problem, not a few bad hosts.\n\n**The Root Cause:**\nYour system requires guests to upload photos. Hosts see the photo before accepting. Implicit bias affects decisions.\n\n**The Proposals:**\nYour team presents several solutions.\n\n**The Trade-offs:**\nTrust and safety require knowing who's staying. But transparency enables discrimination. How do you balance both?\n\n**The Stakes:**\nThis isn't just PR. It's about whether your platform is inclusive or perpetuates societal bias.",
                        question: "How should Airbnb reduce discrimination on the platform?",
                        options: [
                            {
                                text: "Remove all guest photos—hosts can't discriminate if they don't see race",
                                points: 30,
                                feedback: "This addresses discrimination but creates new problems.\n\nHosts rely on photos for trust and safety. Removing photos entirely might reduce bookings or increase host anxiety.\n\nAlso, hosts can still infer race from names in many cases.\n\nThe better approach: reduce the visibility of photos during the booking process, not eliminate them entirely.\n\nAirbnb eventually de-emphasized photos on listings while keeping them in profiles (visible after booking confirmation)."
                            },
                            {
                                text: "Expand Instant Book—guests can book without host approval, bypassing bias",
                                points: 45,
                                feedback: "Brilliant. This is what Airbnb actually did, and it's a masterclass in designing out discrimination.\n\nInstant Book removes the \"host approval\" step where bias occurs. Hosts still set their criteria (dates, price, house rules), but they can't reject guests based on photos.\n\nThis isn't perfect—some hosts disable Instant Book. But by making it the default and incentivizing it (higher search ranking), you dramatically reduce discrimination.\n\nThis is product design as social justice. You didn't try to change hearts and minds. You changed the system that enables bias.\n\nThis is how great PMs think: behavior follows design."
                            },
                            {
                                text: "Train hosts on unconscious bias—education is the long-term solution",
                                points: 25,
                                feedback: "This is well-intentioned but insufficient.\n\nUnconscious bias training has limited effectiveness. Studies show people's behavior changes minimally after training.\n\nThe problem isn't that hosts are consciously racist (most aren't). It's that implicit bias affects decisions.\n\nYou can't train away bias. But you can design systems that don't activate bias.\n\nUse training as a supplement to structural changes (like Instant Book), not a replacement."
                            },
                            {
                                text: "Ban hosts who show patterns of discrimination based on acceptance rates",
                                points: 35,
                                feedback: "This is a strong enforcement mechanism, but it's reactive, not preventive.\n\nBy the time you ban a host for discrimination, many guests have already been harmed.\n\nAlso, proving discrimination is hard. Hosts can claim other reasons for rejections.\n\nBanning is a necessary tool for egregious cases, but the better strategy is designing a system that prevents discrimination from happening in the first place.\n\nUse bans as a backstop, not a primary solution."
                            }
                        ]
                    },
                    {
                        id: 9,
                        scenario: "**November 2016 – Launching Airbnb Experiences**\n\n**The Plateau:**\nAccommodations growth is slowing. You've saturated many markets. What's next?\n\n**The Idea:**\nExpand beyond stays into activities. Let locals host tours, classes, workshops. \"Experiences\" as a new revenue stream.\n\n**The Opportunity:**\nThe global tours and activities market is $150B. Airbnb has brand trust and distribution.\n\n**The Risk:**\nThis is a new marketplace. You'll need to recruit hosts, ensure quality, handle safety, deal with new regulations.\n\n**The Debate:**\nCEO: \"We're a stays company. Experiences dilutes our focus.\"\n\nStrategy team: \"Experiences is a natural extension. Guests want more than a place to stay.\"\n\nFinance: \"Experiences has lower margins than stays. Is this the best use of resources?\"\n\n**The Precedent:**\nViator, GetYourGuide already own this space. You're late.",
                        question: "Should Airbnb launch Experiences as a new product line?",
                        options: [
                            {
                                text: "Yes—launch Experiences, it's a natural extension of the Airbnb brand",
                                points: 45,
                                feedback: "Correct. Airbnb launched Experiences in 2016, and by 2019 had 40,000+ globally.\n\nHere's why this worked: Experiences isn't just another product—it's a strategic moat.\n\nGuests who book both a stay AND an experience have 3x higher lifetime value. They're more loyal, book more often, and refer friends.\n\nExperiences also differentiates Airbnb from Booking.com and Hotels.com. They can copy your stays, but your Experiences network is unique.\n\nThe key was starting small (500 experiences in 12 cities), validating demand, then scaling. You didn't bet the company—you ran an experiment.\n\nThis is how you expand: find adjacencies with high synergy, test, scale what works."
                            },
                            {
                                text: "No—stay focused on accommodations where you have proven product-market fit",
                                points: 25,
                                feedback: "You're playing not to lose instead of playing to win.\n\nYes, focus is important—but adjacent expansion isn't distraction, it's growth strategy.\n\nHere's the trap: if Airbnb only does accommodations, they're leaving money on the table for competitors.\n\nGuests will book stays on Airbnb, then book activities on Viator. You're training users to use multiple platforms, which weakens your lock-in.\n\nThe better strategy: expand into high-synergy adjacencies (Experiences) while avoiding low-synergy ones (e.g., Airbnb Airlines would be dumb).\n\nTest, learn, scale what works. Airbnb did exactly this—launched small, validated demand, then scaled. They didn't bet the company; they ran an experiment."
                            },
                            {
                                text: "Partner with existing tours/activities platforms instead of building in-house",
                                points: 30,
                                feedback: "This is a reasonable compromise—you get the benefit (more services for guests) without the cost (building a new marketplace).\n\nBut here's what you lose: margin, control, and differentiation.\n\nIf you partner with Viator, they keep 70% of revenue, dictate the experience quality, and own the customer relationship. You're a referral source, not a platform.\n\nAirbnb's strength is controlling the end-to-end experience—if you outsource Experiences, you're diluting that advantage.\n\nThe right time to partner is when you can't build fast enough; the wrong time is when you're capable but scared to try."
                            },
                            {
                                text: "Launch a small pilot but don't commit resources until it proves itself at scale",
                                points: 35,
                                feedback: "This is smart de-risking, and it's actually what Airbnb did initially (500 Experiences in 12 cities).\n\nYou're validating demand before scaling supply.\n\nThe only mistake would be under-investing so much that the pilot fails due to poor execution, not lack of market fit.\n\nMake sure your pilot is high-quality—good curation, great hosts, smooth booking UX.\n\nIf you half-ass the test, you'll get half-assed results.\n\nMany new products fail not because the idea was wrong, but because the execution was mediocre. Give your experiment a real chance to succeed."
                            }
                        ]
                    },
                    {
                        id: 10,
                        scenario: "**Late 2019 – Preparing for the Unthinkable**\n\n**The Context:**\nAirbnb is preparing for IPO in 2020. Revenue is $4.8B, bookings at all-time high. The company is finally profitable.\n\n**The Question:**\nYour Chief Risk Officer raises a concern: \"What if a global crisis shuts down travel entirely? A pandemic, financial crash, major war?\"\n\n**The Dismissal:**\nCFO: \"Travel always bounces back. We survived 2008. We'll survive anything.\"\n\n**The Reality:**\n95% of Airbnb's revenue comes from travel bookings (short-term stays). If travel stops, revenue stops. Fixed costs don't.\n\n**The Math:**\nAirbnb has $3B in cash but burns $200M/month in operating costs.\n\n**The Options:**\nYou have budget to build ONE resilience feature before IPO:\n\n1. Long-term stays (30+ days) - less vulnerable to travel shocks\n2. Local experiences - people can book in their own city\n3. Virtual experiences - online classes, no travel required\n4. Monthly rentals - compete with traditional leases",
                        question: "If you could only build ONE resilience feature to hedge against a potential travel shutdown, which would it be?",
                        options: [
                            {
                                text: "Prioritize long-term stays (30+ days)—a hedge against short-term travel volatility",
                                points: 40,
                                feedback: "This is really strong strategic thinking.\n\nLong-term stays are countercyclical to tourism—when short-term travel collapses, demand for temporary housing actually increases (work relocations, housing transitions, remote work).\n\nAirbnb leaned into this during COVID, and it saved the company. Bookings of 28+ days grew 14% even while overall bookings fell 70%.\n\nHere's the insight: duration is diversification. By serving both short-term and long-term stays, you smooth out volatility.\n\nThe only reason this isn't a perfect score is that it doesn't fully solve the supply-side problem—many Airbnb hosts won't rent long-term (they make more on nightly rates).\n\nBut directionally, this is brilliant."
                            },
                            {
                                text: "Build infrastructure for virtual/online experiences—no travel required",
                                points: 45,
                                feedback: "This is what Airbnb actually did in March 2020 when COVID hit, and it was a lifeline for hosts.\n\nHere's the genius: virtual experiences require zero marginal cost (no physical space, no insurance, no local regulations), infinite scale (one host can serve 100 attendees), and zero travel friction.\n\nWhen Airbnb launched \"Online Experiences,\" they had yoga classes, cooking lessons, and magic shows—all from hosts' living rooms.\n\nRevenue was tiny, but it kept hosts engaged, maintained brand relevance, and proved Airbnb could pivot fast.\n\nThe strategic lesson: build optionality before you need it.\n\nAirbnb had the infrastructure ready because they'd already launched Experiences in 2016. When crisis hit, they adapted existing tech instead of building from scratch.\n\nThis is what \"resilient platforms\" look like—they have multiple business models that activate under different conditions."
                            },
                            {
                                text: "Focus on monthly rentals to compete with traditional housing leases",
                                points: 20,
                                feedback: "You're thinking about diversification, but you're entering a market where Airbnb has no competitive advantage.\n\nTraditional rental platforms (Zillow, Apartments.com, Craigslist) already own this space, and the unit economics are terrible—monthly leases mean 12X fewer transactions per unit per year.\n\nPlus, hosts who rent monthly aren't \"sharing economy\" participants; they're professional landlords.\n\nThis dilutes the brand and invites even more housing-crisis regulation.\n\nThe better move is long-term stays (30-90 days), not annual leases—it's still flexible, still \"travel,\" and still Airbnb's wheelhouse."
                            },
                            {
                                text: "Expand \"local experiences\" so users book activities in their own city without travel",
                                points: 30,
                                feedback: "This is clever—you're trying to decouple revenue from travel by making Airbnb useful even at home.\n\nAirbnb did experiment with this (\"local experiences\"), and it got some traction—but it's fundamentally fighting an uphill battle.\n\nMost people don't think of Airbnb for local activities; they think of Yelp, Eventbrite, or Google.\n\nYou're asking users to change their mental model, which is really hard.\n\nThe better strategy is doubling down on what users already associate you with (travel, stays) but expanding the definition (long-term stays, virtual experiences).\n\nDon't fight user psychology—work with it."
                            }
                        ]
                    }
                ]
            };

            // SNIPPET 5: Enhanced tracking with retry logic
            const retryFailedEvents = async () => {
                const failed = JSON.parse(localStorage.getItem('pmSimFailedEvents') || '[]');
                if (failed.length === 0) return;
                
                console.log(`🔄 Retrying ${failed.length} failed events...`);
                const stillFailed = [];
                
                for (const event of failed) {
                    if (event.retryCount >= 3) {
                        console.warn('⚠️ Giving up on event after 3 retries:', event);
                        continue;
                    }
                    
                    try {
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(event)
                        });
                        console.log('✅ Retry successful:', event.status || event.action);
                    } catch (error) {
                        event.retryCount = (event.retryCount || 0) + 1;
                        stillFailed.push(event);
                    }
                }
                
                if (stillFailed.length > 0) {
                    localStorage.setItem('pmSimFailedEvents', JSON.stringify(stillFailed));
                } else {
                    localStorage.removeItem('pmSimFailedEvents');
                    console.log('✅ All failed events recovered!');
                }
            };

            const sendToGoogleSheets = async (data) => {
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    await retryFailedEvents();
                    console.log('✅ Tracked:', data.status || data.action);
                } catch (error) {
                    const failedEvents = JSON.parse(localStorage.getItem('pmSimFailedEvents') || '[]');
                    failedEvents.push({ 
                        ...data, 
                        failedAt: new Date().toISOString(),
                        retryCount: (data.retryCount || 0)
                    });
                    localStorage.setItem('pmSimFailedEvents', JSON.stringify(failedEvents));
                    console.error('❌ Tracking failed (saved for retry):', error);
                }
            };

            const handleEmailSubmit = (e) => {
                e.preventDefault();
                if (email && email.includes('@')) {
                    localStorage.setItem('pmSimEmail', email);
                    localStorage.setItem('pmSimStartTime', new Date().toISOString());
                    sendToGoogleSheets({ email, simulation: 'Week 1 - PM Fundamentals', status: 'started' });
                    setHasStarted(true);
                }
            };

            const handleAnswer = (optionIndex) => {
                setSelectedAnswerIndex(optionIndex);
            };

            const clearStoredProgress = () => {
                localStorage.removeItem('pmSimEmail');
                localStorage.removeItem('pmSimStartTime');
            };

            const handleNextChallenge = () => {
                if (selectedAnswerIndex === null) return;
                
                const currentQ = simulation.questions[currentQuestion];
                const selectedOption = currentQ.options[selectedAnswerIndex];
                const newAnswers = [...answers, { question: currentQuestion, points: selectedOption.points, feedback: selectedOption.feedback }];
                setAnswers(newAnswers);
                setSelectedAnswerIndex(null);

                // SNIPPET 2: Track progress every 3 questions
                if ((currentQuestion + 1) % 3 === 0 && currentQuestion < simulation.questions.length - 1) {
                    sendToGoogleSheets({
                        email,
                        simulation: 'Week 1 - PM Fundamentals',
                        status: 'progress',
                        questionNumber: currentQuestion + 1,
                        totalQuestions: simulation.questions.length
                    });
                }

                if (currentQuestion < simulation.questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                } else {
                    const totalPoints = newAnswers.reduce((sum, answer) => sum + answer.points, 0);
                    const maxPoints = simulation.questions.reduce((sum, q) => sum + Math.max(...q.options.map(o => o.points)), 0);
                    const percentage = Math.round((totalPoints / maxPoints) * 100);
                    
                    let tier = '';
                    if (percentage >= 90) tier = 'Strategic Mastery';
                    else if (percentage >= 75) tier = 'Applied Proficiency';
                    else if (percentage >= 60) tier = 'Core Competency';
                    else tier = 'Foundational Understanding';
                    
                    sendToGoogleSheets({ 
                        email, 
                        simulation: 'Week 1 - PM Fundamentals',
                        score: totalPoints,
                        percentage,
                        tier
                    });
                    
                    setShowResults(true);
                    localStorage.setItem('pm_simulation_week1_attempted', 'true');
                    clearStoredProgress();
                }
            };

            const calculateScore = () => {
                const totalPoints = answers.reduce((sum, answer) => sum + answer.points, 0);
                const maxPoints = simulation.questions.reduce((sum, q) => sum + Math.max(...q.options.map(o => o.points)), 0);
                return { totalPoints, maxPoints, percentage: Math.round((totalPoints / maxPoints) * 100) };
            };

            const getNarrative = (percentage) => {
                if (percentage >= 90) {
                    return {
                        title: "Strategic Mastery",
                        text: "Outstanding! You demonstrated exceptional understanding of PM fundamentals. Your answers show you grasp the strategic nature of product management - balancing user needs, business goals, and team dynamics. You understand that PMs are decision-makers who use frameworks, data, and judgment to drive outcomes. You're thinking like a seasoned PM who knows when to lead, when to listen, and when to dig deeper. This level of product intuition typically takes years to develop.",
                        tier: "Strategic Mastery"
                    };
                } else if (percentage >= 75) {
                    return {
                        title: "Applied Proficiency",
                        text: "Strong performance! You showed solid grasp of PM core competencies. You understand the PM role is about making tough trade-off decisions with incomplete information. Your answers reflect good judgment on prioritization, stakeholder management, and user-centric thinking. A few decisions leaned too heavily on one dimension (execution vs strategy, or data vs intuition). The best PMs balance all aspects. Keep practicing framework-driven decision making and study real PM case studies to sharpen your instincts.",
                        tier: "Applied Proficiency"
                    };
                } else if (percentage >= 60) {
                    return {
                        title: "Core Competency",
                        text: "You're building a solid foundation in product management. You understand some key concepts - PMs make decisions, use data, balance stakeholders - but missed opportunities to apply structured thinking. Several answers confused PM with Project Manager or Product Owner roles, or showed tactical thinking where strategic thinking was needed. Focus on learning frameworks like RICE prioritization, Jobs-to-be-Done, and the distinction between outputs (features) and outcomes (user value). Read 'Inspired' by Marty Cagan and study how top PMs think.",
                        tier: "Core Competency"
                    };
                } else {
                    return {
                        title: "Foundational Understanding",
                        text: "You're at the beginning of your PM journey. Several answers suggest you're still learning what product management fundamentally is - it's not project management, not product ownership, and not just shipping features. PMs are strategic decision-makers who discover what users need, prioritize ruthlessly, and drive business outcomes. Start with fundamentals: Read 'Inspired' by Marty Cagan, study the product lifecycle, and learn prioritization frameworks. Watch PM interviews and case study breakdowns. The good news: These are all learnable skills. Keep studying and practicing!",
                        tier: "Foundational Understanding"
                    };
                }
            };

            // Helper function to format text with proper paragraph breaks
            const formatText = (text) => {
                if (!text) return '';
                const paragraphs = text.split('\n\n').filter(p => p.trim());
                
                return paragraphs.map((para, paraIndex) => {
                    // Check if paragraph contains **bold** markdown
                    if (para.includes('**')) {
                        const parts = [];
                        const regex = /(\*\*[^*]+\*\*)/g;
                        let lastIndex = 0;
                        let match;
                        
                        while ((match = regex.exec(para)) !== null) {
                            // Add text before the bold
                            if (match.index > lastIndex) {
                                parts.push(para.substring(lastIndex, match.index));
                            }
                            // Add bold text (remove ** markers)
                            const boldText = match[0].replace(/\*\*/g, '');
                            parts.push(h('strong', { key: `bold-${paraIndex}-${match.index}` }, boldText));
                            lastIndex = match.index + match[0].length;
                        }
                        
                        // Add remaining text
                        if (lastIndex < para.length) {
                            parts.push(para.substring(lastIndex));
                        }
                        
                        return h('p', { 
                            key: paraIndex,
                            className: 'mb-4 last:mb-0'
                        }, parts.length > 0 ? parts : para.trim());
                    }
                    
                    // No bold markdown, return plain paragraph
                    return h('p', { 
                        key: paraIndex,
                        className: 'mb-4 last:mb-0'
                    }, para.trim());
                });
            };

            const shareToLinkedIn = () => {
                const score = calculateScore();
                const narrative = getNarrative(score.percentage);
                
                const linkedInText = `I just completed Week 1 of the PM Simulation Series: Airbnb Platform Evolution! 🚀\n\nScore: ${score.totalPoints}/${score.maxPoints} (${score.percentage}%)\nTier: ${narrative.tier}\n\nThis deep-dive case study tested real decisions from Airbnb's journey (2009-2019)—from the NYC photo crisis to scaling globally.\n\nKey lessons: When to do things that don't scale, how to turn costs into moats, and why mechanism design matters for marketplace trust.\n\n#ProductManagement #Airbnb #PMSimulation`;
                
                navigator.clipboard.writeText(linkedInText);
                sendToGoogleSheets({ 
                    email, 
                    simulation: 'Week 1 - PM Fundamentals', 
                    score: score.totalPoints,
                    percentage: score.percentage,
                    tier: narrative.tier,
                    action: 'SHARED_ON_LINKEDIN'
                });
                alert('Copied to clipboard! Paste this into LinkedIn.');
            };

            const downloadBadge = () => {
                const score = calculateScore();
                const narrative = getNarrative(score.percentage);
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 600;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = '#1e40af';
                ctx.fillRect(0, 0, 800, 600);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 32px Arial';
                ctx.fillText('PM Simulation Certificate', 50, 100);
                ctx.font = '24px Arial';
                ctx.fillText('Week 1: Airbnb Platform Evolution', 50, 150);
                ctx.font = '20px Arial';
                ctx.fillText(email, 50, 250);
                ctx.font = 'bold 28px Arial';
                ctx.fillText(`${narrative.tier}`, 50, 320);
                ctx.font = '24px Arial';
                ctx.fillText(`Score: ${score.totalPoints}/${score.maxPoints} (${score.percentage}%)`, 50, 380);
                ctx.font = '18px Arial';
                ctx.fillText('Completed: ' + new Date().toLocaleDateString(), 50, 450);
                
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'PM-Simulation-Certificate.png';
                    a.click();
                    
                    sendToGoogleSheets({ 
                        email, 
                        simulation: 'Week 1 - PM Fundamentals', 
                        score: score.totalPoints,
                        percentage: score.percentage,
                        tier: narrative.tier,
                        action: 'DOWNLOADED_BADGE'
                    });
                });
            };

            if (hasAttempted) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center p-6' },
                    h('div', { className: 'max-w-md bg-white rounded-2xl shadow-xl p-8 text-center' },
                        h('div', { className: 'w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6' },
                            h(TrophyIcon)
                        ),
                        h('h2', { className: 'text-2xl font-bold text-gray-900 mb-4' }, 'Already Completed'),
                        h('p', { className: 'text-gray-600 mb-6' }, 'You can only attempt this simulation once to maintain data integrity. Thank you for participating!'),
                        h('p', { className: 'text-sm text-gray-500' }, 'Check your email for results or share your achievement on LinkedIn.')
                    )
                );
            }

            if (!hasStarted) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center p-6' },
                    h('div', { className: 'max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden' },
                        h('div', { className: 'bg-gradient-to-r from-indigo-600 to-blue-600 p-8 text-white' },
                            h('h1', { className: 'text-3xl font-bold mb-2' }, simulation.title),
                            h('p', { className: 'text-blue-100' }, `${simulation.week} • ${simulation.company} • ${simulation.year}`)
                        ),
                        h('div', { className: 'p-8' },
                            h('p', { className: 'text-gray-700 text-lg mb-6 leading-relaxed' }, simulation.description),
                            h('div', { className: 'bg-blue-50 border-l-4 border-blue-600 p-4 mb-6' },
                                h('h3', { className: 'font-semibold text-blue-900 mb-2' }, 'What You\'ll Learn:'),
                                h('ul', { className: 'text-blue-800 space-y-2 text-sm' },
                                    h('li', null, '✓ When to do things that don\'t scale'),
                                    h('li', null, '✓ How to turn costs into competitive moats'),
                                    h('li', null, '✓ Mechanism design for marketplace trust'),
                                    h('li', null, '✓ Proactive regulatory strategy'),
                                    h('li', null, '✓ Crisis management and resilience planning')
                                )
                            ),
                            h('form', { onSubmit: handleEmailSubmit, className: 'space-y-4' },
                                h('div', null,
                                    h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Enter your email to begin:'),
                                    h('input', {
                                        type: 'email',
                                        value: email,
                                        onChange: (e) => setEmail(e.target.value),
                                        placeholder: 'your.email@example.com',
                                        className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent',
                                        required: true
                                    })
                                ),
                                h('button', {
                                    type: 'submit',
                                    className: 'w-full bg-gradient-to-r from-indigo-600 to-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-indigo-700 hover:to-blue-700 transition-all duration-200 shadow-lg'
                                }, 'Start Simulation →')
                            ),
                            h('p', { className: 'text-xs text-gray-500 mt-4 text-center' }, '⏱️ Estimated time: 20-25 minutes • 💡 One attempt per user')
                        )
                    )
                );
            }

            if (showResults) {
                const score = calculateScore();
                const narrative = getNarrative(score.percentage);
                
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6' },
                    h('div', { className: 'max-w-4xl mx-auto' },
                        h('div', { className: 'bg-white rounded-2xl shadow-xl overflow-hidden mb-6' },
                            h('div', { className: 'bg-gradient-to-r from-indigo-600 to-blue-600 p-8 text-white text-center' },
                                h('div', { className: 'w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-6' },
                                    h(TrophyIcon, { className: 'text-indigo-600' })
                                ),
                                h('h1', { className: 'text-4xl font-bold mb-2' }, narrative.title),
                                h('p', { className: 'text-3xl font-bold mb-2' }, `${score.percentage}%`),
                                h('p', { className: 'text-xl text-blue-100' }, `${score.totalPoints} / ${score.maxPoints} points`)
                            ),
                            h('div', { className: 'p-8' },
                                h('p', { className: 'text-lg text-gray-700 mb-8 leading-relaxed' }, narrative.text),
                                h('div', { className: 'flex gap-4 justify-center mb-8' },
                                    h('button', {
                                        onClick: shareToLinkedIn,
                                        className: 'flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors'
                                    }, h(Share2Icon), 'Share on LinkedIn'),
                                    h('button', {
                                        onClick: downloadBadge,
                                        className: 'flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors'
                                    }, h(TrophyIcon), 'Download Certificate')
                                ),
                                h('div', { className: 'space-y-6' },
                                    answers.map((answer, idx) => {
                                        const q = simulation.questions[idx];
                                        const correctAnswer = q.options.reduce((best, opt) => opt.points > best.points ? opt : best);
                                        const userAnswer = q.options.find((opt, i) => opt.points === answer.points);
                                        const isCorrect = userAnswer.points === correctAnswer.points;
                                        
                                        return h('div', { key: idx, className: 'border-l-4 ' + (isCorrect ? 'border-green-500 bg-green-50' : 'border-yellow-500 bg-yellow-50') + ' p-6 rounded-r-lg' },
                                            h('div', { className: 'flex justify-between items-start mb-3' },
                                                h('h3', { className: 'font-bold text-lg text-gray-900' }, `Question ${idx + 1}`),
                                                h('span', { className: 'text-sm font-semibold px-3 py-1 rounded-full ' + (isCorrect ? 'bg-green-600 text-white' : 'bg-yellow-600 text-white') },
                                                    `${answer.points}/${correctAnswer.points} points`
                                                )
                                            ),
                                            h('div', { className: 'bg-white border border-gray-200 p-4 rounded mb-4' },
                                                h('p', { className: 'text-sm font-semibold text-gray-900 mb-2' }, 'Your answer:'),
                                                h('p', { className: 'text-gray-700' }, userAnswer.text)
                                            ),
                                            h('div', { className: 'bg-blue-50 border-l-4 border-blue-600 p-4 rounded-r' },
                                                h('div', { className: 'text-xs font-bold text-blue-900 uppercase tracking-wide mb-2' }, '💬 Feedback'),
                                                h('div', { className: 'feedback-content' }, formatText(userAnswer.feedback)),
                                                !isCorrect && h('div', { className: 'mt-4 pt-4 border-t border-blue-200' },
                                                    h('p', { className: 'text-xs font-semibold text-blue-800 mb-2' }, 'Why the optimal answer is better:'),
                                                    h('div', { className: 'feedback-content' }, formatText(correctAnswer.feedback))
                                                )
                                            )
                                        );
                                    })
                                )
                            )
                        ),
                        h('div', { className: 'text-center mt-6 text-sm text-gray-500' }, '💡 This was Week 1 of 20 in the PM Simulation Series')
                    )
                );
            }

            const currentQ = simulation.questions[currentQuestion];
            
            return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6' },
                h('div', { className: 'max-w-3xl mx-auto' },
                    h('div', { className: 'mb-8' },
                        h('div', { className: 'flex justify-between text-sm text-gray-600 mb-2' },
                            h('span', null, `Question ${currentQuestion + 1} of ${simulation.questions.length}`),
                            h('span', null, `${Math.round(((currentQuestion) / simulation.questions.length) * 100)}% Complete`)
                        ),
                        h('div', { className: 'w-full bg-gray-200 rounded-full h-2' },
                            h('div', {
                                className: 'bg-gradient-to-r from-indigo-600 to-blue-600 h-2 rounded-full transition-all duration-500',
                                style: { width: `${((currentQuestion) / simulation.questions.length) * 100}%` }
                            })
                        )
                    ),
                    h('div', { className: 'bg-white rounded-2xl shadow-xl overflow-hidden' },
                        h('div', { className: 'bg-gradient-to-r from-gray-50 to-gray-100 p-8 border-b border-gray-200' },
                            h('div', { className: 'flex items-start gap-4' },
                                h('div', { className: 'w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0' },
                                    h('span', { className: 'text-white font-bold text-lg' }, currentQuestion + 1)
                                ),
                                h('div', { className: 'flex-1' },
                                    h('div', { className: 'section-label mb-2' }, 'Scenario'),
                                    h('div', { className: 'scenario-content' }, formatText(currentQ.scenario))
                                )
                            )
                        ),
                        h('div', { className: 'p-8' },
                            h('div', { className: 'question-text mb-6' }, currentQ.question),
                            h('div', { className: 'space-y-3 mb-8' },
                                currentQ.options.map((option, idx) => {
                                    const isSelected = selectedAnswerIndex === idx;
                                    return h('button', {
                                        key: idx,
                                        onClick: () => handleAnswer(idx),
                                        className: `w-full text-left p-5 rounded-xl border-2 transition-all duration-200 ${
                                            isSelected 
                                            ? 'border-indigo-600 bg-indigo-50 shadow-md' 
                                            : 'border-gray-200 hover:border-indigo-300 hover:bg-gray-50'
                                        }`
                                    },
                                        h('div', { className: 'flex items-start gap-3' },
                                            h('div', { className: `w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${
                                                isSelected ? 'border-indigo-600 bg-indigo-600' : 'border-gray-300'
                                            }` },
                                                isSelected && h('div', { className: 'w-2.5 h-2.5 bg-white rounded-full' })
                                            ),
                                            h('span', { className: 'option-text' }, option.text)
                                        )
                                    );
                                })
                            ),
                            h('button', {
                                onClick: handleNextChallenge,
                                disabled: selectedAnswerIndex === null,
                                className: `w-full py-4 px-6 rounded-xl font-semibold transition-all duration-200 ${
                                    selectedAnswerIndex === null
                                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                    : 'bg-gradient-to-r from-indigo-600 to-blue-600 text-white hover:from-indigo-700 hover:to-blue-700 shadow-lg hover:shadow-xl'
                                }`
                            }, currentQuestion < simulation.questions.length - 1 ? 'Next Question →' : 'See Results →')
                        )
                    ),
                    h('div', { className: 'text-center mt-6 text-sm text-gray-500' }, '💡 Choose carefully - you only get one attempt at this module')
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(PMSimulation));

        // SNIPPET 5: Retry failed events on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                const failed = JSON.parse(localStorage.getItem('pmSimFailedEvents') || '[]');
                if (failed.length > 0) {
                    console.log('🔄 Found failed events, will retry...');
                }
            }, 2000);
        });
    </script>
</body>
</html>
